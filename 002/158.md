Bouncy Taffy Orca

Medium

# Signature verification does not comply with EIP-712 array encoding standard

### Summary

The incorrect array encoding in `_isSignatureValid` function might cause signature verification issues as the contract does not comply with EIP-712 array encoding requirements, making the signature verification incompatible with standard EIP-712 implementations.

### Root Cause

In `VVVVCTokenDistributor.sol`, the `_isSignatureValid` function incorrectly encodes arrays by directly including them in the main `abi.encode` call instead of hashing them separately as required by EIP-712 standard.


The arrays `projectTokenProxyWallets` and `tokenAmountsToClaim` should be encoded separately using `keccak256(abi.encode())` before being included in the main struct hash. [GitHub Link](https://github.com/sherlock-audit/2024-11-vvv-exchange-update/blob/1791f41b310489aaa66de349ef1b9e4bd331f14b/vvv-platform-smart-contracts/contracts/vc/VVVVCTokenDistributor.sol#L167-L168)

### Internal pre-conditions


1. Somone attempts to call `claim` function with a signature generated following EIP-712 standard
2. The signature includes arrays (`projectTokenProxyWallets` and `tokenAmountsToClaim`)

### External pre-conditions

_No response_

### Attack Path

_No response_

### Impact

The protocol's signature verification might be incompatible with standard EIP-712 implementations as:
- Signatures generated by standard EIP-712 tools and libraries might fail verification
- Frontend applications using standard EIP-712 signing methods might not work with the contract
- Any integrations expecting EIP-712 compliance might fail


This would affect the core claim functionality of the protocol as it relies on valid signature verification.

### PoC

_No response_

### Mitigation

Modify the `_isSignatureValid` function to properly encode arrays according to EIP-712:
```diff
function _isSignatureValid(ClaimParams memory _params) private view returns (bool) {
    bytes32 digest = keccak256(
        abi.encodePacked(
            "\x19\x01",
            DOMAIN_SEPARATOR,
            keccak256(
                abi.encode(
                    CLAIM_TYPEHASH,
                    _params.kycAddress,
                    _params.projectTokenAddress,
-                   _params.projectTokenProxyWallets,
-                   _params.tokenAmountsToClaim,
+                   keccak256(abi.encode(_params.projectTokenProxyWallets)),
+                   keccak256(abi.encode(_params.tokenAmountsToClaim)),
                    _params.nonce,
                    _params.deadline
                )
            )
        )
    );
```